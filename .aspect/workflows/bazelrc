# build without the bytes
common --remote_download_outputs=minimal
common --nobuild_runfile_links

# Allows tests to run bazelisk-in-bazel, since this is the cache folder used
common --test_env=XDG_CACHE_HOME

##################################
# RBE
#
# Always enable remote execution.
# We test the local execution case in the "vanilla GitHub Actions" setup in /.github/workflows/ci.yaml
build --host_platform=@aspect_bazel_lib//platforms:x86_64_linux_remote
build --extra_execution_platforms=@aspect_bazel_lib//platforms:x86_64_linux_remote
build --remote_executor=unix:///mnt/ephemeral/buildbarn/.cache/bb_clientd/grpc
# 8 is the max scaling for the "staging" RBE cluster
build --jobs=8
build --remote_timeout=3600
build --genrule_strategy=remote

# We are using RBE to test that the actions we create in rules_ts will work for our customers,
# not to accelerate and parallelize the builds for unrelated actions that happen to appear in our dependencies.
# So, turn off RBE for actions that are known to be problematic because they are non-hermetic.
# build:rbe --modify_execution_info=CppCompile=+no-remote-exec,CppLink=+no-remote-exec,GenProtoDescriptorSet=+no-remote-exec,ProtocGenEs=+no-remote-exec

build --announce_rc
build --noremote_local_fallback
